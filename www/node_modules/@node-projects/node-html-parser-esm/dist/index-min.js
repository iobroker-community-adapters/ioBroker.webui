import{decode as st}from"@node-projects/lean-he-esm";import{encode as it}from"@node-projects/lean-he-esm";var c=class{parentNode;childNodes=[];range;constructor(t=null,e){this.parentNode=t,Object.defineProperty(this,"range",{enumerable:!1,writable:!0,configurable:!0,value:e??[-1,-1]})}remove(){if(this.parentNode){let t=this.parentNode.childNodes;this.parentNode.childNodes=t.filter(e=>this!==e),this.parentNode=null}return this}get innerText(){return this.rawText}get textContent(){return st(this.rawText)}set textContent(t){this.rawText=it(t)}};var B;(function(n){n[n.ELEMENT_NODE=1]="ELEMENT_NODE",n[n.TEXT_NODE=3]="TEXT_NODE",n[n.COMMENT_NODE=8]="COMMENT_NODE"})(B||(B={}));var l=B;var C=class n extends c{rawText;clone(){return new n(this.rawText,null)}constructor(t,e,r){super(e,r),this.rawText=t}nodeType=l.COMMENT_NODE;get text(){return this.rawText}toString(){return`<!--${this.rawText}-->`}};function b(n){return n[n.length-1]}var O=class{addClosingSlash;voidTags;constructor(t=!1,e){this.addClosingSlash=t,Array.isArray(e)?this.voidTags=e.reduce((r,s)=>r.add(s.toLowerCase()),new Set):this.voidTags=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"].reduce((r,s)=>r.add(s),new Set)}formatNode(t,e,r){let s=this.addClosingSlash,i=s&&e&&!e.endsWith(" ")?" ":"",o=s?`${i}/`:"";return this.isVoidElement(t.toLowerCase())?`<${t}${e}${o}>`:`<${t}${e}>${r}</${t}>`}isVoidElement(t){return this.voidTags.has(t)}};import{decode as nt}from"@node-projects/lean-he-esm";var f=class n extends c{clone(){return new n(this._rawText,null)}constructor(t,e,r){super(e,r),this._rawText=t}nodeType=l.TEXT_NODE;_rawText;_trimmedRawText;_trimmedText;get rawText(){return this._rawText}set rawText(t){this._rawText=t,this._trimmedRawText=void 0,this._trimmedText=void 0}get trimmedRawText(){return this._trimmedRawText!==void 0?this._trimmedRawText:(this._trimmedRawText=G(this.rawText),this._trimmedRawText)}get trimmedText(){return this._trimmedText!==void 0?this._trimmedText:(this._trimmedText=G(this.text),this._trimmedText)}get text(){return nt(this.rawText)}get isWhitespace(){return/^(\s|&nbsp;)*$/.test(this.rawText)}toString(){return this.rawText}};function G(n){let t=0,e,r;for(;t>=0&&t<n.length;)/\S/.test(n[t])&&(e===void 0?(e=t,t=n.length):(r=t,t=void 0)),e===void 0?t++:t--;e===void 0&&(e=0),r===void 0&&(r=n.length-1);let s=e>0&&/[^\S\r\n]/.test(n[e-1]),i=r<n.length-1&&/[^\S\r\n]/.test(n[r+1]);return(s?" ":"")+n.slice(e,r+1)+(i?" ":"")}import{decode as I}from"@node-projects/lean-he-esm";var ot=["h1","h2","h3","h4","h5","h6","header","hgroup"],at=["details","dialog","dd","div","dt"],lt=["fieldset","figcaption","figure","footer","form"],ht=["table","td","tr"],dt=["address","article","aside","blockquote","br","hr","li","main","nav","ol","p","pre","section","ul"],V=new Set;function ut(...n){let t=e=>{for(let r=0;r<e.length;r++){let s=e[r];V.add(s),V.add(s.toUpperCase())}};for(let e of n)t(e)}ut(ot,at,lt,ht,dt);var j=class{_set;_afterUpdate;_validate(t){if(/\s/.test(t))throw new Error(`DOMException in DOMTokenList.add: The token '${t}' contains HTML space characters, which are not valid in tokens.`)}constructor(t=[],e=()=>null){this._set=new Set(t),this._afterUpdate=e}add(t){this._validate(t),this._set.add(t),this._afterUpdate(this)}replace(t,e){this._validate(e),this._set.delete(t),this._set.add(e),this._afterUpdate(this)}remove(t){this._set.delete(t)&&this._afterUpdate(this)}toggle(t){this._validate(t),this._set.has(t)?this._set.delete(t):this._set.add(t),this._afterUpdate(this)}contains(t){return this._set.has(t)}get length(){return this._set.size}values(){return this._set.values()}get value(){return Array.from(this._set.values())}toString(){return Array.from(this._set.values()).join(" ")}},L=class n extends c{rawAttrs;voidTag;_attrs;_rawAttrs;_parseOptions;rawTagName;id;classList;nodeType=l.ELEMENT_NODE;quoteAttribute(t){return t==null?"null":JSON.stringify(t.replace(/"/g,"&quot;"))}constructor(t,e={},r="",s,i,o=new O,d={}){if(super(s,i),this.rawAttrs=r,this.voidTag=o,this.rawTagName=t,this.rawAttrs=r||"",this.id=e.id||"",this.childNodes=[],this._parseOptions=d,this.classList=new j(e.class?e.class.split(/\s+/):[],p=>this.setAttribute("class",p.toString())),e.id&&(r||(this.rawAttrs=`id="${e.id}"`)),e.class&&!r){let p=`class="${this.classList.toString()}"`;this.rawAttrs?this.rawAttrs+=` ${p}`:this.rawAttrs=p}}removeChild(t){return this.childNodes=this.childNodes.filter(e=>e!==t),this}exchangeChild(t,e){let r=this.childNodes;return this.childNodes=r.map(s=>s===t?e:s),this}get tagName(){return this.rawTagName?this.rawTagName.toUpperCase():this.rawTagName}set tagName(t){this.rawTagName=t.toLowerCase()}get localName(){return this.rawTagName.toLowerCase()}get isVoidElement(){return this.voidTag.isVoidElement(this.localName)}get rawText(){return this.childNodes.reduce((t,e)=>t+=e.rawText,"")}get textContent(){return I(this.rawText)}set textContent(t){let e=[new f(t,this)];this.childNodes=e}get text(){return I(this.rawText)}get structuredText(){let t=[],e=[t];function r(s){if(s.nodeType===l.ELEMENT_NODE)V.has(s.rawTagName)?(t.length>0&&e.push(t=[]),s.childNodes.forEach(r),t.length>0&&e.push(t=[])):s.childNodes.forEach(r);else if(s.nodeType===l.TEXT_NODE)if(s.isWhitespace)t.prependWhitespace=!0;else{let i=s.trimmedText;t.prependWhitespace&&(i=` ${i}`,t.prependWhitespace=!1),t.push(i)}}return r(this),e.map(s=>s.join("").replace(/\s{2,}/g," ")).join(`
`).replace(/\s+$/,"")}toString(){let t=this.rawTagName;if(t){let e=this.rawAttrs?` ${this.rawAttrs}`:"";return this.voidTag.formatNode(t,e,this.innerHTML)}return this.innerHTML}get innerHTML(){return this.childNodes.map(t=>t.toString()).join("")}set innerHTML(t){let e=x(t,this._parseOptions),r=e.childNodes.length?e.childNodes:[new f(t,this)];w(r,this),w(this.childNodes,null),this.childNodes=r}set_content(t,e={}){if(t instanceof c)t=[t];else if(typeof t=="string"){e={...this._parseOptions,...e};let r=x(t,e);t=r.childNodes.length?r.childNodes:[new f(r.innerHTML,this)]}return w(this.childNodes,null),w(t,this),this.childNodes=t,this}replaceWith(...t){let e=this.parentNode,r=t.map(i=>{if(i instanceof c)return[i];if(typeof i=="string"){let o=x(i,this._parseOptions);return o.childNodes.length?o.childNodes:[new f(i,this)]}return[]}).flat(),s=e.childNodes.findIndex(i=>i===this);return w([this],null),e.childNodes=[...e.childNodes.slice(0,s),...w(r,e),...e.childNodes.slice(s+1)],this}get outerHTML(){return this.toString()}trimRight(t){for(let e=0;e<this.childNodes.length;e++){let r=this.childNodes[e];if(r.nodeType===l.ELEMENT_NODE)r.trimRight(t);else{let s=r.rawText.search(t);s>-1&&(r.rawText=r.rawText.substr(0,s),this.childNodes.length=e+1)}}return this}get structure(){let t=[],e=0;function r(i){t.push("  ".repeat(e)+i)}function s(i){let o=i.id?`#${i.id}`:"",d=i.classList.length?`.${i.classList.value.join(".")}`:"";r(`${i.rawTagName}${o}${d}`),e++,i.childNodes.forEach(p=>{p.nodeType===l.ELEMENT_NODE?s(p):p.nodeType===l.TEXT_NODE&&(p.isWhitespace||r("#text"))}),e--}return s(this),t.join(`
`)}removeWhitespace(){let t=0;return this.childNodes.forEach(e=>{if(e.nodeType===l.TEXT_NODE){if(e.isWhitespace)return;e.rawText=e.trimmedRawText}else e.nodeType===l.ELEMENT_NODE&&e.removeWhitespace();this.childNodes[t++]=e}),this.childNodes.length=t,this}getElementsByTagName(t){let e=t.toUpperCase(),r=[],s=[],i=this,o=0;for(;o!==void 0;){let d;do d=i.childNodes[o++];while(o<i.childNodes.length&&d===void 0);if(d===void 0){i=i.parentNode,o=s.pop();continue}d.nodeType===l.ELEMENT_NODE&&((t==="*"||d.tagName===e)&&r.push(d),d.childNodes.length>0&&(s.push(o),i=d,o=0))}return r}getElementById(t){let e=[],r=this,s=0;for(;s!==void 0;){let i;do i=r.childNodes[s++];while(s<r.childNodes.length&&i===void 0);if(i===void 0){r=r.parentNode,s=e.pop();continue}if(i.nodeType===l.ELEMENT_NODE){if(i.id===t)return i;i.childNodes.length>0&&(e.push(s),r=i,s=0)}}return null}appendChild(t){return t.remove(),this.childNodes.push(t),t.parentNode=this,t}get firstChild(){return this.childNodes[0]}get lastChild(){return b(this.childNodes)}get attrs(){if(this._attrs)return this._attrs;this._attrs={};let t=this.rawAttributes;for(let e in t){let r=t[e]||"";this._attrs[e.toLowerCase()]=I(r)}return this._attrs}get attributes(){let t={},e=this.rawAttributes;for(let r in e){let s=e[r]||"";t[r]=I(s)}return t}get rawAttributes(){if(this._rawAttrs)return this._rawAttrs;let t={};if(this.rawAttrs){let e=/([a-zA-Z()[\]#@$.?:][a-zA-Z0-9-_:()[\]#]*)(?:\s*=\s*((?:'[^']*')|(?:"[^"]*")|\S+))?/g,r;for(;r=e.exec(this.rawAttrs);){let s=r[1],i=r[2]||null;i&&(i[0]==="'"||i[0]==='"')&&(i=i.slice(1,i.length-1)),t[s]=t[s]||i}}return this._rawAttrs=t,t}removeAttribute(t){let e=this.rawAttributes;return delete e[t],this._attrs&&delete this._attrs[t],this.rawAttrs=Object.keys(e).map(r=>{let s=JSON.stringify(e[r]);return s===void 0||s==="null"?r:`${r}=${s}`}).join(" "),t==="id"&&(this.id=""),this}hasAttribute(t){return t.toLowerCase()in this.attrs}getAttribute(t){return this.attrs[t.toLowerCase()]}setAttribute(t,e){if(arguments.length<2)throw new Error("Failed to execute 'setAttribute' on 'Element'");let r=t.toLowerCase(),s=this.rawAttributes;for(let i in s)if(i.toLowerCase()===r){t=i;break}return s[t]=String(e),this._attrs&&(this._attrs[r]=I(s[t])),this.rawAttrs=Object.keys(s).map(i=>{let o=this.quoteAttribute(s[i]);return o==="null"||o==='""'?i:`${i}=${o}`}).join(" "),t==="id"&&(this.id=e),this}setAttributes(t){return this._attrs&&delete this._attrs,this._rawAttrs&&delete this._rawAttrs,this.rawAttrs=Object.keys(t).map(e=>{let r=t[e];return r==="null"||r==='""'?e:`${e}=${this.quoteAttribute(String(r))}`}).join(" "),this}insertAdjacentHTML(t,e){if(arguments.length<2)throw new Error("2 arguments required");let r=x(e,this._parseOptions);if(t==="afterend"){let s=this.parentNode.childNodes.findIndex(i=>i===this);w(r.childNodes,this.parentNode),this.parentNode.childNodes.splice(s+1,0,...r.childNodes)}else if(t==="afterbegin")w(r.childNodes,this),this.childNodes.unshift(...r.childNodes);else if(t==="beforeend")r.childNodes.forEach(s=>{this.appendChild(s)});else if(t==="beforebegin"){let s=this.parentNode.childNodes.findIndex(i=>i===this);w(r.childNodes,this.parentNode),this.parentNode.childNodes.splice(s,0,...r.childNodes)}else throw new Error(`The value provided ('${t}') is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'`);return this}get nextSibling(){if(this.parentNode){let t=this.parentNode.childNodes,e=0;for(;e<t.length;){let r=t[e++];if(this===r)return t[e]||null}return null}}get nextElementSibling(){if(this.parentNode){let t=this.parentNode.childNodes,e=0,r=!1;for(;e<t.length;){let s=t[e++];if(r){if(s instanceof n)return s||null}else this===s&&(r=!0)}return null}}get previousSibling(){if(this.parentNode){let t=this.parentNode.childNodes,e=t.length;for(;e>0;){let r=t[--e];if(this===r)return t[e-1]||null}return null}}get previousElementSibling(){if(this.parentNode){let t=this.parentNode.childNodes,e=t.length,r=!1;for(;e>0;){let s=t[--e];if(r){if(s instanceof n)return s||null}else this===s&&(r=!0)}return null}}get classNames(){return this.classList.toString()}clone(){return x(this.toString(),this._parseOptions).firstChild}},T=/<!--[\s\S]*?-->|<(\/?)([a-zA-Z][-.:0-9_a-zA-Z]*)((?:\s+[^>]*?(?:(?:'[^']*')|(?:"[^"]*"))?)*)\s*(\/?)>/g,ct=/(?:^|\s)(id|class)\s*=\s*((?:'[^']*')|(?:"[^"]*")|\S+)/gi,ft={area:!0,AREA:!0,base:!0,BASE:!0,br:!0,BR:!0,col:!0,COL:!0,hr:!0,HR:!0,img:!0,IMG:!0,input:!0,INPUT:!0,link:!0,LINK:!0,meta:!0,META:!0,source:!0,SOURCE:!0,embed:!0,EMBED:!0,param:!0,PARAM:!0,track:!0,TRACK:!0,wbr:!0,WBR:!0},Q={li:{li:!0,LI:!0},LI:{li:!0,LI:!0},p:{p:!0,div:!0,P:!0,DIV:!0},P:{p:!0,div:!0,P:!0,DIV:!0},b:{div:!0,DIV:!0},B:{div:!0,DIV:!0},td:{td:!0,th:!0,TD:!0,TH:!0},TD:{td:!0,th:!0,TD:!0,TH:!0},th:{td:!0,th:!0,TD:!0,TH:!0},TH:{td:!0,th:!0,TD:!0,TH:!0},h1:{h1:!0,H1:!0},H1:{h1:!0,H1:!0},h2:{h2:!0,H2:!0},H2:{h2:!0,H2:!0},h3:{h3:!0,H3:!0},H3:{h3:!0,H3:!0},h4:{h4:!0,H4:!0},H4:{h4:!0,H4:!0},h5:{h5:!0,H5:!0},H5:{h5:!0,H5:!0},h6:{h6:!0,H6:!0},H6:{h6:!0,H6:!0}},Y={li:{ul:!0,ol:!0,UL:!0,OL:!0},LI:{ul:!0,ol:!0,UL:!0,OL:!0},a:{div:!0,DIV:!0},A:{div:!0,DIV:!0},b:{div:!0,DIV:!0},B:{div:!0,DIV:!0},i:{div:!0,DIV:!0},I:{div:!0,DIV:!0},p:{div:!0,DIV:!0},P:{div:!0,DIV:!0},td:{tr:!0,table:!0,TR:!0,TABLE:!0},TD:{tr:!0,table:!0,TR:!0,TABLE:!0},th:{tr:!0,table:!0,TR:!0,TABLE:!0},TH:{tr:!0,table:!0,TR:!0,TABLE:!0}},k="documentfragmentcontainer";function U(n,t={}){let e=new O(t?.voidTag?.closingSlash,t?.voidTag?.tags),r=t.blockTextElements||{script:!0,noscript:!0,style:!0,pre:!0},s=Object.keys(r),i=s.map(u=>new RegExp(`^${u}$`,"i")),o=s.filter(u=>r[u]).map(u=>new RegExp(`^${u}$`,"i"));function d(u){return o.some(m=>m.test(u))}function p(u){return i.some(m=>m.test(u))}let D=(u,m)=>[u-Z,m-Z],q=new L(null,{},"",null,[0,n.length],e,t),a=q,g=[q],E=-1,$,X;n=`<${k}>${n}</${k}>`;let{lowerCaseTagName:z,fixNestedATags:tt}=t,et=n.length-(k.length+2),Z=k.length+2;for(;X=T.exec(n);){let{0:u,1:m,2:h,3:F,4:K}=X,P=u.length,M=T.lastIndex-P,R=T.lastIndex;if(E>-1&&E+P<R){let N=n.substring(E,M);a.appendChild(new f(N,a,D(E,M)))}if(E=T.lastIndex,h!==k){if(u[1]==="!"){if(t.comment){let N=n.substring(M+4,R-3);a.appendChild(new C(N,a,D(M,R)))}continue}if(z&&(h=h.toLowerCase()),!m){let N={};for(let A;A=ct.exec(F);){let{1:S,2:_}=A,H=_[0]==="'"||_[0]==='"';N[S.toLowerCase()]=H?_.slice(1,_.length-1):_}let J=a.rawTagName;!K&&Q[J]&&Q[J][h]&&(g.pop(),a=b(g)),tt&&(h==="a"||h==="A")&&($!==void 0&&(g.splice($),a=b(g)),$=g.length);let y=T.lastIndex,rt=y-P;if(a=a.appendChild(new L(h,N,F.slice(1),null,D(rt,y),e,t)),g.push(a),p(h)){let A=`</${h}>`,S=z?n.toLocaleLowerCase().indexOf(A,T.lastIndex):n.indexOf(A,T.lastIndex),_=S===-1?et:S;if(d(h)){let H=n.substring(y,_);H.length>0&&/\S/.test(H)&&a.appendChild(new f(H,a,D(y,_)))}S===-1?E=T.lastIndex=n.length+1:(E=T.lastIndex=S+A.length,m="/")}}if(m||K||ft[h])for(;;)if($!=null&&(h==="a"||h==="A")&&($=void 0),a.rawTagName===h){a.range[1]=D(-1,Math.max(E,R))[1],g.pop(),a=b(g);break}else{let N=a.tagName;if(Y[N]&&Y[N][h]){g.pop(),a=b(g);continue}break}}}return g}function x(n,t={}){let e=U(n,t),[r]=e;for(;e.length>1;){let s=e.pop(),i=b(e);s.parentNode&&s.parentNode.parentNode&&(s.parentNode===i&&s.tagName===i.tagName?t.parseNoneClosedTags!==!0&&(i.removeChild(s),s.childNodes.forEach(o=>{i.parentNode.appendChild(o)}),e.pop()):t.parseNoneClosedTags!==!0&&(i.removeChild(s),s.childNodes.forEach(o=>{i.appendChild(o)})))}return r}function w(n,t){return n.map(e=>(e.parentNode=t,e))}function W(n,t={}){return U(n,t).length===1}function v(n,t={}){return x(n,t)}v.parse=x;v.HTMLElement=L;v.CommentNode=C;v.valid=W;v.Node=c;v.TextNode=f;v.NodeType=l;export{C as CommentNode,L as HTMLElement,c as Node,l as NodeType,f as TextNode,v as default,v as parse,W as valid};
